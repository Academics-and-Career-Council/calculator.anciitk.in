{"version":3,"file":"index.js","sources":["../src/Loader.tsx","../src/index.tsx"],"sourcesContent":["import styles from './styles.module.css'\nimport React from 'react';\n\nexport default function loader(){\n    return(\n        <div className={styles.container}>\n            <div className={styles.logo}>\n            <img src=\"/anc-logo.png\" width=\n        {150} height={150}/>\n            </div>\n\n        <div className={styles.loader}>Loading...</div>\n        </div>  \n    );\n}","import React, { useEffect, useState } from 'react'\nimport type { AxiosError } from 'axios' // eslint-disable-line\nimport Result, { ResultStatusType } from 'antd/lib/result'\nimport Button from 'antd/lib/button'\nimport { Xenon, UserCredentials, Role } from '@anciitk/xenon-js'\nimport './styles.module.css' // eslint-disable-line\nimport { V0alpha1Api, Session } from '@ory/kratos-client' // eslint-disable-line\n\nimport Loader from './Loader'\n\nexport interface SessionState {\n  active: boolean\n  logoutUrl: string\n  user: UserCredentials\n  session: Session\n}\n\ninterface Props {\n  loginUrl: string\n  path: string\n  basePath: string\n  historyPush: (route: string) => void\n  sessionState: SessionState | undefined\n  setSessionState: (session: SessionState) => void\n  ory: V0alpha1Api\n  xenon: Xenon\n  roles: Array<Role>\n}\n\nconst VerifyPage: React.FC<Props> = ({\n  ory,\n  loginUrl,\n  basePath,\n  path,\n  historyPush,\n  sessionState,\n  setSessionState,\n  xenon,\n  roles\n}) => {\n  const [err, setErr] = useState<AxiosError>()\n  const [denied, setDenied] = useState<boolean>(false)\n\n  useEffect(() => {\n    ory\n      .toSession()\n      .then(({ data: session }) => {\n        ory\n          .createSelfServiceLogoutFlowUrlForBrowsers()\n          .then(({ data: logout }) => {\n            xenon\n              .whoami()\n              .then((user) => {\n                setSessionState({\n                  active: true,\n                  logoutUrl: logout.logout_url || '',\n                  user: user,\n                  session: session\n                })\n              })\n              .catch((err) => {\n                throw new Error(err)\n              })\n          })\n          .catch((err) => {\n            return Promise.reject(err)\n          })\n      })\n      .catch((err) => {\n        switch (err.response?.status) {\n          case 403:\n            window.location.href = `${loginUrl}`\n          case 401:\n            window.location.href = `${loginUrl}?return_to=${basePath}/${path}`\n            return\n        }\n        setErr(err)\n        return Promise.reject(err)\n      })\n  }, [])\n\n  useEffect(() => {\n    if (sessionState && sessionState.active) {\n      if (sessionState.user.role in roles) historyPush(`/${path}`)\n      else setDenied(true)\n    }\n  }, [sessionState])\n\n  return (\n    <div>\n      {err && !denied ? (\n        <Result\n          status={(err.response?.status as ResultStatusType) || 500}\n          title={err.message + '!' || 'Sorry, something went wrong.'}\n          subTitle={err.response?.statusText || 'Please try again later'}\n          extra={[\n            <a href={loginUrl} key='1'>\n              <Button type='primary'>Go to Login</Button>\n            </a>\n          ]}\n        />\n      ) : (\n        <Loader />\n      )}\n      {denied && (\n        <Result\n          status='403'\n          title={'Sorry, you are not authorzied to view this page'}\n          subTitle={\n            'Please ask the administrator to grant you necessary rights'\n          }\n          extra={[\n            <a href={loginUrl} key='1'>\n              <Button type='primary'>Go to Dashboard</Button>\n            </a>\n          ]}\n        />\n      )}\n    </div>\n  )\n}\n\nexport default VerifyPage\n"],"names":["loader","React","className","styles","container","logo","src","width","height","VerifyPage","ory","loginUrl","basePath","path","historyPush","sessionState","setSessionState","xenon","roles","useState","err","setErr","denied","setDenied","useEffect","toSession","then","session","data","createSelfServiceLogoutFlowUrlForBrowsers","logout","whoami","user","active","logoutUrl","logout_url","Error","Promise","reject","response","status","window","location","href","role","Result","title","message","subTitle","statusText","extra","key","Button","type","Loader"],"mappings":"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"}